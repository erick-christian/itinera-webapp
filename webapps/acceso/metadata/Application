{
    "type": "Ext.app.Application",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "name": "acceso",
        "views": [
            "winAcceso",
            "winResetAcceso",
            "MyWindow1"
        ]
    },
    "name": "Application",
    "designerId": "application",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "launch",
                "implHandler": [
                    "//http://www.kunal-chowdhury.com/2012/10/how-to-update-application-cache-programmatically-in-html5.html\r",
                    "var applicationCache = window.applicationCache;\r",
                    "\r",
                    "switch (applicationCache.status) {\r",
                    "  case applicationCache.UNCACHED: // UNCACHED = 0\r",
                    "    console.log('UNCACHED');\r",
                    "    break;\r",
                    "  case applicationCache.IDLE: // IDLE = 1\r",
                    "    console.log('IDLE');\r",
                    "    break;\r",
                    "  case applicationCache.CHECKING: // CHECKING = 2\r",
                    "    console.log('CHECKING');\r",
                    "    break;\r",
                    "  case applicationCache.DOWNLOADING: // DOWNLOADING = 3\r",
                    "    console.log('DOWNLOADING');\r",
                    "    break;\r",
                    "  case applicationCache.UPDATEREADY:  // UPDATEREADY = 4\r",
                    "    console.log('UPDATEREADY');\r",
                    "    break;\r",
                    "  case applicationCache.OBSOLETE: // OBSOLETE = 5\r",
                    "    console.log('OBSOLETE');\r",
                    "    break;\r",
                    "  default:\r",
                    "    console.log('UKNOWN CACHE STATUS');\r",
                    "    break;\r",
                    "}\r",
                    "\r",
                    "if(applicationCache.status !== applicationCache.UNCACHED){\r",
                    "    applicationCache.update(); // Take an attempt to update the user's cache.\r",
                    "    if (applicationCache.status == window.applicationCache.UPDATEREADY) {\r",
                    "        applicationCache.swapCache();  // The fetch was successful, swap to the new cache.\r",
                    "        if (confirm('Una nueva versión de ésta aplicación está disponible. Desea cargarla?')) {\r",
                    "            window.location.reload();\r",
                    "        }\r",
                    "    }\r",
                    "}\r",
                    "\r",
                    "appLocal = this.getApplication();\r",
                    "aplicacionLocal = this;\r",
                    "\r",
                    "var tituloAplicacion = datosOpenLink('tituloAplicacion');\r",
                    "Ext.getDoc().dom.title = tituloAplicacion;\r",
                    "\r",
                    "var nombreSistema = configuracionSistema('nombreSistema');\r",
                    "nombreSistema = nombreSistema + ' (Liberación: ' + releaseActiva() + ')';\r",
                    "\r",
                    "Ext.getCmp('winAcceso').setTitle(nombreSistema);\r",
                    "\r",
                    "var iconoAplicacion = datosOpenLink('servidorWeb');\r",
                    "iconoAplicacion = iconoAplicacion + 'copamex/framework/ambiente/ambiente.ico';\r",
                    "\r",
                    "cambiaFavicon(iconoAplicacion);\r",
                    "\r",
                    "appLocal.ajustaInterface();\r",
                    "asignaValorElemento('txtAmbienteActivo',datosOpenLink('ambiente'));"
                ]
            },
            "name": "launch",
            "designerId": "24ba0a35-ce93-4f16-89c4-b19273c8d6ce"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "accederSistema",
                "implHandler": [
                    "var indDatosValidos = true;\r",
                    "\r",
                    "var f_clave  = leeValorElemento('p_clavePersona');\r",
                    "var f_acceso = leeValorElemento('p_acceso');\r",
                    "\r",
                    "if (f_clave === '' || f_acceso === ''){\r",
                    "    mensajeUsr(\"ERROR\",\r",
                    "              \"Información requerida\",\r",
                    "              \"Debe ingresar Usuario y Contraseña\");\r",
                    "\r",
                    "    indDatosValidos = false;\r",
                    "}\r",
                    "\r",
                    "if(indDatosValidos){\r",
                    "\r",
                    "    arrayInformacion = new Array();\r",
                    "    arrayInformacion[0] = new Object();\r",
                    "    arrayInformacion[0].codSistema        = configuracionSistema('codSistema');\r",
                    "    arrayInformacion[0].clavePersona      = f_clave;\r",
                    "    arrayInformacion[0].acceso            = f_acceso;\r",
                    "    arrayInformacion[0].codEmpresaActiva  = configuracionSistema('codEmpresaActiva');\r",
                    "    arrayInformacion[0].codSucursalActiva = configuracionSistema('codSucursalActiva');\r",
                    "    arrayInformacion[0].openLinkServidor  = datosOpenLink('servidor');\r",
                    "    arrayInformacion[0].openLinkServicio  = datosOpenLink('servicio');\r",
                    "    arrayInformacion[0].openLinkPrograma  = datosOpenLink('programa');\r",
                    "\r",
                    "    var strJson = JSON.stringify(arrayInformacion);\r",
                    "\r",
                    "    var datosJsonFormulario = {codPrograma       : \"api_AccesoPortal\",\r",
                    "                               codProcedimiento  : \"validaAcceso\",\r",
                    "                               tipoLlamada       : \"formulario\",\r",
                    "                               usuarioActivo     : f_clave,\r",
                    "                               datosJson         : strJson,\r",
                    "                               codEmpresa        : configuracionSistema('codEmpresa'),\r",
                    "                               codSistema        : configuracionSistema('codSistema'),\r",
                    "                               codEmpresaActiva  : configuracionSistema('codEmpresaActiva'),\r",
                    "                               codSucursalActiva : configuracionSistema('codSucursalActiva'),\r",
                    "                               openLinkServidor  : datosOpenLink('servidor'),\r",
                    "                               openLinkServicio  : datosOpenLink('servicio'),\r",
                    "                               openLinkPrograma  : datosOpenLink('programa')\r",
                    "                               };\r",
                    "\r",
                    "    deshabilitaElemento('p_clavePersona');\r",
                    "    deshabilitaElemento('p_acceso');\r",
                    "    deshabilitaElemento('btnAcceder');\r",
                    "\r",
                    "    var cajaEspera = Ext.MessageBox.show({\r",
                    "        msg: 'Por favor espere, se están validando sus credenciales...',\r",
                    "        progressText: 'Validando Acceso',\r",
                    "        width:400,\r",
                    "        wait:true,\r",
                    "        waitConfig: {interval:170}\r",
                    "    });\r",
                    "\r",
                    "    Ext.Ajax.request({\r",
                    "        url: '../../../../../../openLink/openLink.jsp',\r",
                    "        method: 'POST',\r",
                    "        success: function(response,opts){\r",
                    "            /* ECRC: Función cuando se ejecuta correctamente el Script en el Servidor */\r",
                    "            var datosJson = Ext.decode(response.responseText);\r",
                    "\r",
                    "            if(datosJson.success === true ){\r",
                    "                /* ECRC: API ejecutada correctamente y sin Errores */\r",
                    "\r",
                    "                var temp_datos_sesion = datosJson.temp_datos_sesion[0];\r",
                    "                var mensajeAcceso = '';\r",
                    "\r",
                    "                var cajaEspera = Ext.MessageBox.show({\r",
                    "                    msg: 'Por favor espere mientras es direccionado al Menú Principal.',\r",
                    "                    progressText: 'Acceso Correcto',\r",
                    "                    width:400,\r",
                    "                    wait:true,\r",
                    "                    waitConfig: {interval:170}\r",
                    "                });\r",
                    "                generaSesion(temp_datos_sesion);\r",
                    "                window.open(configuracionSistema('portal'),'_self','toolbar=no');\r",
                    "\r",
                    "            }\r",
                    "            else{\r",
                    "                /* ECRC: Errores encontrados en la API */\r",
                    "                var aMensaje = datosJson.temp_mensaje;\r",
                    "                var mensajeError = \"\";\r",
                    "\r",
                    "                for(var iCiclo = 0; iCiclo<aMensaje.length; iCiclo++){\r",
                    "                    mensajeError += aMensaje[iCiclo].mensaje + \"</br></br>\";\r",
                    "                }\r",
                    "\r",
                    "                habilitaElemento('p_clavePersona');\r",
                    "                habilitaElemento('p_acceso');\r",
                    "                habilitaElemento('btnAcceder');\r",
                    "\r",
                    "                mensajeUsr(\"ERROR\",\r",
                    "                           \"Error de Acceso\",\r",
                    "                           mensajeError);\r",
                    "            }\r",
                    "         },\r",
                    "        failure: function(response,opts){\r",
                    "            /* ECRC: Función cuando hay Error en la Ejecución en el Servidor */\r",
                    "            console.log('Servidor falló con el Código ' + response.status);\r",
                    "            habilitaElemento('p_clavePersona');\r",
                    "            habilitaElemento('p_acceso');\r",
                    "            habilitaElemento('btnAcceder');\r",
                    "\r",
                    "        },\r",
                    "        params: datosJsonFormulario\r",
                    "    });\r",
                    "\r",
                    "    cajaEspera.hide();\r",
                    "}"
                ]
            },
            "name": "accederSistema",
            "designerId": "bfb9df6c-d845-43a0-9130-5f0f94bce5a5"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "ajustaInterface",
                "implHandler": [
                    "Ext.getCmp('formAcceso').doLayout();"
                ]
            },
            "name": "ajustaInterface",
            "designerId": "fbceec62-0c83-46d2-900b-150eef1ce76d"
        }
    ]
}